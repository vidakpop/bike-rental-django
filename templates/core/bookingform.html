{%load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Home</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abhaya+Libre">
    <link rel="stylesheet" href="{% static 'assets/css/styles.css' %}">
    <link rel="stylesheet" href="% static 'assets/css/styles.min.css'%">
    <link rel="stylesheet" href="{% static 'assets/css/features-boxed.css' %}">
    <script src="https://kit.fontawesome.com/a076d05399.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

    </head>
    <body style="background-color: rgb(255,255,255);">
        <nav class="navbar navbar-dark navbar-expand-md navigation-clean-search" style="color: rgb(2,6,10);background-color: #5c5e62;">
            <div class="container">
                <a class="navbar-brand" href="#">BikeChapchap</a>
                <button data-toggle="collapse" class="navbar-toggler" data-target="#navcol-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse"
                    id="navcol-1">
                    <ul class="nav navbar-nav">
                        <li class="nav-item" role="presentation">
                            <a class="nav-link" href="{%url 'core:index'%}">HOME</a>
                        </li>
                        <li class="dropdown nav-item">
                            <a class="dropdown-toggle nav-link" data-toggle="dropdown" aria-expanded="false" href="#">PRODUCTS</a>
                            <div class="dropdown-menu" role="menu">
                                <a class="dropdown-item" role="presentation" href="#">Bikes</a>
                                <a class="dropdown-item" role="presentation" href="#">Scooters</a>
                                <a class="dropdown-item" role="presentation" href="#"></a>
                            </div>
                        </li>
                    </ul>
                    <form class="form-inline mr-auto" target="_self">
                        <div class="form-group">
                            <label for="search-field">
                                <i class="fa fa-search" style="padding: 16px;">
                                </i>
                            </label>
                            <input class="form-control search-field" type="search" id="search-field" name="search"></div>
                    </form>
                    <span class="navbar-text">
                        <a class="login" href="{%url 'userauths:login'%}" style="color: rgb(238,245,245); margin:20PX ;">Log In  </a>
                    </span>
                    <a class="btn btn-light action-button" role="button" href="{%url 'userauths:signup'%}">Sign Up</a>
                </div>
            </div>
        </nav>
        
        <!-- Start: Registration Form with Photo -->
        
        <style>
            .default-img {
             max-width: 100%;
             max-height: 600px;
            /* Add more styles as needed */
       } 
         </style>  
        <style>
        .product-box {
         border: 1px solid #e94545;
         padding: 15px;
         position: relative;
         max-width: 200px; /* Set a maximum width */
         margin: 0 auto; /* Center the box */
         text-align: left; /* Align text to the left */
       }

        .image-box img {
           width: 200px; /* Set a fixed width */
           height: 200px; /* Set a fixed height */
           object-fit: cover;
    }
 
       .details-box {
         background-color: #f9f9f9;
         padding: 10px;
         max-height: 150px;
         overflow: hidden;
    }

       .category {
         font-size: 14px;
         margin-bottom: 5px;
         text-align:left;
    }
        .vendor {
         font-size: 14px;
         margin-bottom: 5px;
         text-align:right;
     }

        .button-box {
        text-align: center;
        margin-top: 10px;
    }
       </style>

        <style>
          .product-box {
         border: 1px solid #ccc;
         padding: 15px;
         position: relative;
         text-align: left;
         overflow: hidden;
    }

       .image-box {
        position: relative;
     }

      .image-box img {
        width: 200px; /* Set a fixed width */
        height: 200px; /* Set a fixed height */
        object-fit: cover;
    }

      .vendor {
        position: absolute;
        top: 5px;
        right: 5px;
        background-color: #ff0000;
        color: white;
        padding: 3px 5px;
        font-size: 10px;
    }

      .details-box {
        background-color: #f9f9f9;
        padding: 10px;
        max-height: 150px;
        overflow: hidden;
    }

     .title {
        font-size: 14px;
        margin-bottom: 5px;
    }

     .button-box {
        text-align: center;
        margin-top: 10px;
    }
     .price {
         position: relative;
         text-align: center;
    }

     .actual-price {
          font-size: 18px; /* Adjust font size of the new price */
    }

     .discounted-price {
        display: block;
        text-decoration: line-through;
        font-size: 14px; /* Adjust font size of the old price */
        color: #999; /* Color of the old price */
        position: absolute;
        top: 50%; /* Positioning old price in the middle */
        left: 0;
        right: 0;
        transform: translateY(50%);
    }
    
          </style>




<div class="login-clean" style="background-image: url(&quot;/static/assets/img/utah-mountain-biking-bike-biking-71104.jpeg&quot;);height: auto;width: 100%;">
            <div class="row no-gutters">
                <div class="col-md-4">
                    
                </div>
                <div class="col11-md-8">
                    <div class="card-body" style="width: 100%;">
                        <form method="post" style="margin: 120px;">
                            <div class="product-box">
                                <div class="image-box">
                                    <img class="img-fluid" src="{{ product.image.url }}" alt="">
                                    <h3 class="vendor">{{ product.vendor }}</h3>
                                </div>
                                <div class="details-box">
                                    <h3 class="category">{{ product.category.title }}</h3>
                                    <p class="title">{{ product.title }} </p>
                                    <p class="ratings">★★★★☆ {{ product.ratings }}</p>
                                    <p class="price"id="product-price">Kshs.{{product.price}}/hr</p>
                                        
                                    
                                    <!--<p class="description">In perfect condition.</p> -->
                                </div>
                        <label for="">ID</label>
                        <div class="form-group"><input class="form-control" type="text" name="ID" placeholder="ID"></div>
                        <div class="form-group">
                            <label for=""> from</label>
                            <input class="form-control" type="date" name="from" placeholder="from">
                            <label for="">To</label>
                            <input class="form-control" type="date" name="to" placeholder="to">
    
                        </div>
                        
                        <div class="form-group">
                                <label for="">From</label>
                                <input class="form-control" type="time" name="from_time" id="from_time" required>
                                <label for="">To</label>
                                <input class="form-control" type="time" name="to_time" id="to_time" required>
                         </div>
                         
                         
                       
                        
                        <div id="countdown"></div>
                        <form id="bookingForm" method="post" action="{% url 'core:bookingform' %}">
                            {% csrf_token %}
                            <input type="text" name="phone_number" placeholder="Phone Number">
                            <input type="text" name="amount" placeholder="Amount" value="{{ product.price|floatformat:0 }}"readonly>
                            <!-- Add other necessary fields for the payment -->
                        
                            <button class="btn btn-primary btn-block" type="submit" style="background-color: rgb(33, 48, 53);">
                                Book
                            </button>
                        </form>
                        
                        
                </div>
              </div>
                </div>
              </div>
            </div>
          </div>
          <script>
         function initiateMpesaPayment() {
    const mpesaDetails = {
        // Your logic to get M-Pesa details from the form
        // Example: Replace this with your logic to get phone number, amount, account reference, etc.
        phone_number: document.getElementById('phone_number').value,
        amount: document.getElementById('amount').value,
        // Add other necessary details
    };

    fetch('/   mpesa_payment/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(mpesaDetails),
    })
    .then(response => {
        if (response.ok) {
            // Handle successful response
            // For demonstration, showing a success message on the same page
            const successMessage = document.createElement('p');
            successMessage.textContent = 'Payment initiated successfully!';
            // You can append this message wherever you want in your HTML structure
            document.body.appendChild(successMessage);
        } else {
            // Handle errors (e.g., display error message)
            console.error('Error initiating payment:', response.statusText);
        }
    })
    .catch(error => {
        // Handle network errors
        console.error('Network error:', error);
    });
}


          </script>

          <script>
            // Get the countdown element
            const countdownElement = document.getElementById('countdown');
        
            // Function to calculate and display the countdown
            function updateCountdown() {
                // Get the 'from' and 'to' time values from the form
                const fromTime = document.getElementsByName('from_time')[0].value;
                const toTime = document.getElementsByName('to_time')[0].value;
        
                // Convert time strings to Date objects (assuming today's date)
                const fromDateTime = new Date(`2000-01-01T${fromTime}`);
                const toDateTime = new Date(`2000-01-01T${toTime}`);
        
                // Calculate the time difference in milliseconds
                const timeDifference = toDateTime - fromDateTime;
        
                // Calculate hours, minutes, seconds from milliseconds
                const hours = Math.floor(timeDifference / (1000 * 60 * 60));
                const minutes = Math.floor((timeDifference % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDifference % (1000 * 60)) / 1000);
        
                // Display the countdown
                countdownElement.innerHTML = `Time Remaining: ${hours}h ${minutes}m ${seconds}s`;
            }
        
            // Update the countdown on form input change
            document.getElementsByName('from_time')[0].addEventListener('change', updateCountdown);
            document.getElementsByName('to_time')[0].addEventListener('change', updateCountdown);
        </script>
        
    <!-- End: Registration Form with Photo -->
    <!--<script src="{% static 'assets/js/jquery.min.js' %}"></script>
    <script src="{% static 'assets/bootstrap/js/bootstraproduct.min.js' %}"></script>-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstraproduct.bundle.min.js"></script>
    </body>
</html>